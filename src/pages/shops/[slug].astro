---
import { getCollection, CollectionEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { Image } from "astro:assets";
import { getEntry } from "astro:content";
import Breadcrumb from "../../components/Breadcrumb.astro";
import Price from "../../components/Price.astro";
import PageFacilities from "../../components/PageFacilities.astro";
import EnquireNow from "../../components/EnquireNow.astro";
import Form from "../../components/Form.astro";

export const getStaticPaths = async () => {
    const shops = await getCollection("shops");

    const shopPaths = shops.map((shop) => {
        return {
            params: {
                slug: shop.slug,
            },
            props: {
                shop,
            },
        };
    });
    return shopPaths;
};

type Props = {
    shop: CollectionEntry<"shops">;
};

const { shop } = Astro.props;
const { Content } = await shop.render();
const { price } = shop.data;
const { data: shopData } = await getEntry("shopPrice", price.id);

const parsepsf = shopData.priceNow;
const parsesize = shop.data.size;
const BSPPrice = (parsepsf * parsesize) / 100000;

---

<Layout title={shop.data.title}>

    <Breadcrumb title={shop.data.title} />
    <div class="grid grid-cols-2 gap-16 px-20">
        <div class="relative py-8">
            <Image
            src={shop.data.image}
            alt={shop.data.title}
            format="webp"
            class="shadow-xl mb-2 object-cover w-full"
        />
        </div>
        <div class="py-8">
            <h4 class="text-right text-xl font-bold">Last Updated: {shop.data.date} </h4>
            <h4 class="text-right text-xl font-bold">Category: {shop.data.category}</h4>
            <div class="mb-8">
                <Price price= {BSPPrice} />
            </div>
            <PageFacilities
            size={shop.data.size} 
            price={shopData.priceNow}
            floor={shop.data.floor} 
            discount={shop.data.discount} 
            corner={shop.data.corner}
            status={shop.data.status}
            byowner={shop.data.byowner}
            brokerage={shop.data.brokerage}
            plc={shop.data.plc}
            giftvisit={shop.data.giftvisit}
            giftbuy={shop.data.giftbuy}
            />
            <div class="my-8">
                <EnquireNow />
            </div>
            <h4 class="italic font-bold">{shop.data.info}</h4>
        </div>
    </div>
    <div class="grid grid-cols-2 gap-16 px-20">
        <div>
            
        </div>
        <div>
            <Form />
        </div>
    </div>
    <div class="prose-xl overflow-visible relative mb-20 px-20">
        <Content />
    </div>
</Layout>
